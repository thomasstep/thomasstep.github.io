I"◊K<p>I have not seen too much written about IIFEs in Javascript, but I think that they are a super useful tool for converting chunks of synchronous code to execute asynchronously.</p>

<p>In a nutshell, an <a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIFE is just a function that you execute at the same time you define it</a>.
The following is an example of a Hello World function running as a normal function and as an IIFE.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Normal function</span>
<span class="kd">function</span> <span class="nx">helloWorld</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World from normal function!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">helloWorld</span><span class="p">();</span>

<span class="c1">// IIFE</span>
<span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World from IIFE!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>Go ahead and copy paste that into a file and run it, I‚Äôll wait.
You should see</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World from normal <span class="k">function</span><span class="o">!</span>
Hello World from IIFE!
</code></pre></div></div>

<p>When I first learned about this syntax I did not think too much about it.
If you are simply wrapping static statements, why not just write out the statements?
If there is some sort of parameter that you want to pass as a variable, why not just make it a function and call it normally?
I still have not personally come across a use case for IIFEs in those contexts; however, I have come across use cases for using it to convert synchronous code to run asynchronously.</p>

<p>Before I go any further, I am assuming that you know about <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await">async code in JavaScript</a>, specifically Node, and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all">Promise.all</a>.
The whole topic of async code is a bigger concept in and of itself, so if you do not know much about it, then I suggest learning that first.
If you already know about how async programming works, then <code class="language-plaintext highlighter-rouge">Promise.all</code> will not be hard to understand.
It is simply a way to block execution until the <code class="language-plaintext highlighter-rouge">Promises</code> you provide the function resolve.
An example looks like this.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">echo</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">string</span><span class="p">);</span>
  <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
  <span class="nx">echo</span><span class="p">(</span><span class="dl">'</span><span class="s1">first</span><span class="dl">'</span><span class="p">),</span>
  <span class="nx">echo</span><span class="p">(</span><span class="dl">'</span><span class="s1">second</span><span class="dl">'</span><span class="p">)</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">((</span><span class="nx">nums</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nums</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>You can run this, but don‚Äôt expect anything profound to log.
This is what I got</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>first
second
<span class="o">[</span> 1, 2 <span class="o">]</span>
</code></pre></div></div>

<p>All I am trying to illustrate is that <code class="language-plaintext highlighter-rouge">Promise.all</code> takes in an iterable object and resolves an array of all the resolved <code class="language-plaintext highlighter-rouge">Promises</code> you gave it.
Easy.
Next comes the fun part.</p>

<p>Let‚Äôs say I have some synchronous code that takes ‚Äúforever‚Äù to run.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">sleep</span><span class="p">(</span><span class="nx">ms</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func1</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func2</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func3</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func4</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">hrtime</span><span class="p">();</span>

  <span class="kd">const</span> <span class="nx">num1</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func1</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">num2</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func2</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">num3</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func3</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">num4</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func4</span><span class="p">();</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">endS</span><span class="p">,</span> <span class="nx">endNs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">hrtime</span><span class="p">(</span><span class="nx">startTime</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">endNs</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">+</span> <span class="nx">endS</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">endTime</span><span class="p">}</span><span class="s2"> ms`</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Result: </span><span class="p">${</span><span class="nx">num1</span> <span class="o">+</span> <span class="nx">num2</span> <span class="o">+</span> <span class="nx">num3</span> <span class="o">+</span> <span class="nx">num4</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</code></pre></div></div>

<p>Here I‚Äôm using functions, but let‚Äôs pretend that each function represents statements that reach out to DBs and other APIs and take a while to resolve.
For fun I‚Äôll say that <code class="language-plaintext highlighter-rouge">func1</code> and <code class="language-plaintext highlighter-rouge">func2</code> reach out to a REST API, <code class="language-plaintext highlighter-rouge">func3</code> reaches out to a GraphQL API, <code class="language-plaintext highlighter-rouge">func4</code> reaches out to a DB.
We‚Äôll go ahead and say that these functions each represent 20 lines of code or so that connect to the various endpoints and get the correct data because using IIFEs looks a lot better that way.</p>

<p>Now transitioning the previous code snippet to IIFEs we have something that looks like this.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">sleep</span><span class="p">(</span><span class="nx">ms</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func1</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func2</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func3</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">func4</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">hrtime</span><span class="p">();</span>
  <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
    <span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">num1</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func1</span><span class="p">();</span>
      <span class="kd">const</span> <span class="nx">num2</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func2</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">num1</span> <span class="o">+</span> <span class="nx">num2</span><span class="p">;</span>
    <span class="p">})(),</span>
    <span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">num3</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func3</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">num3</span><span class="p">;</span>
    <span class="p">})(),</span>
    <span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">num4</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">func4</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">num4</span><span class="p">;</span>
    <span class="p">})(),</span>
  <span class="p">]).</span><span class="nx">then</span><span class="p">(([</span><span class="nx">num1plus2</span><span class="p">,</span> <span class="nx">num3</span><span class="p">,</span> <span class="nx">num4</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">endS</span><span class="p">,</span> <span class="nx">endNs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">hrtime</span><span class="p">(</span><span class="nx">startTime</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">endNs</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">+</span> <span class="nx">endS</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">endTime</span><span class="p">}</span><span class="s2"> ms`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Result: </span><span class="p">${</span><span class="nx">num1plus2</span> <span class="o">+</span> <span class="nx">num3</span> <span class="o">+</span> <span class="nx">num4</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</code></pre></div></div>

<p>Again, try to think of each function that I am calling in the IIFEs as being multiple statements long and not simply a function.
I am trying to highlight what IIFEs are, not what goes in them.
Also, please note that the IIFE that I just wrote is unlike the original Hello World one at the top in that this most recent one was <code class="language-plaintext highlighter-rouge">async</code>.
With that disclaimer, I hope you ran both of the last two snippets.
If you decided to not run those snippets and instead are just reading along, let me share with you what I got.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Awaiting run</span>
10002.1091 ms
Result: 10

<span class="c"># IIFE run</span>
4001.5615 ms
Result: 10
</code></pre></div></div>

<p>The time it takes to get through all of that logic and communication goes from ~10 seconds down to ~4 seconds (or the longest set Timeout).
Remember, I am trying to think of it as reaching out to two different APIs and a DB which took me a total of 10 seconds before the IIFE conversion.
This gets more and more powerful once you start writing code in chunks that process data independently of other chunks, converting those independent chunks into IIFEs, and then running those IIFEs in parallel.
If you can unwind those independent pieces and put the dependent ones into IIFEs, you can significantly speed up your processing time.
I can see this being incredibly useful to applications that crunch a ton of data (data science?) or reach out to multiple different services at once before doing anything with the returned data.
I have personally used it with success on code that reaches out to multiple APIs at once and then acts on that data once all of the resources have returned.
I have also used it with success while looping through some large arrays with <code class="language-plaintext highlighter-rouge">map</code>, <code class="language-plaintext highlighter-rouge">reduce</code>, <code class="language-plaintext highlighter-rouge">forEach</code>, etc.</p>

<p>Have you ever used this type of approach?
Are there any potential downfalls of doing something like this?
Did you know about IIFEs and have you used them before?</p>

<p>I feel like I see a lack of people writing about using them, but I think they are fun and definitely beneficial.</p>
:ET